<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<dom-module id="data-provider">
  <script>
    /**
     * @customElement
     * @polymer
     */
    class DataProvider extends Polymer.Element {
      static get is() {
        return 'data-provider';
      }
      static get properties() {
        return {
          host: {
            type: String,
          },
          path: {
            type: String,
          },
          headers: {
            type: String,
          },
          params: {
            type: String,
          },
          method: {
            type: String,
          },
          onRequestSuccess: {
            type: String,
            notify: true,
            readOnly: true,
          },
          onRequestError: {
            type: String,
            notify: true,
            readOnly: true,
          }
        };
      }

      generateRequest() {
        const realPath = `${this.host}${this.path}`;
        const myFetchData = {
          method: this.method,
          headers: {}
        }

        fetch(realPath, myFetchData)
          .then((response) => {
            if (response.ok) {
              this._requestSuccess(response.text());
            } else {
              throw new Error('Something went wrong');
            }
          })
          .catch((error) => {
            this._requestError(error);
          });
      }

      _requestSuccess(apiData) {
        apiData
          .then((data) => {
            this.dispatchEvent(
              new CustomEvent('request-success', {
                bubbles: true,
                composed: true,
                detail: {
                  data
                },
              })
            );
          })
      }

      _requestError(errorData) {
        this.dispatchEvent(
          new CustomEvent('request-error', {
            bubbles: true,
            composed: true,
            detail: {
              error: errorData
            }
          })
        )
      }

      constructor() {
        super();
      }

      ready() {
        super.ready();
        this.generateRequest();
      }
    }

    window.customElements.define(DataProvider.is, DataProvider);

  </script>
</dom-module>
